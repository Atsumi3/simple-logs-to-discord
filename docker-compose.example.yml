# Example: Terraria server with Discord notifications
version: "3.8"

services:
  terraria:
    image: ryshe/terraria:latest
    container_name: terraria
    stdin_open: true
    tty: true
    ports:
      - "7777:7777"
    volumes:
      - ./worlds:/root/.local/share/Terraria/Worlds
    restart: unless-stopped

  log-watcher:
    build: .
    # Or use: image: simple-logs-to-discord
    environment:
      - LOG_SOURCE=docker:terraria
      - PATTERNS=["(?P<player>.+) has joined\\.", "(?P<player>.+) has left\\."]
      - DISCORD_WEBHOOK=${DISCORD_WEBHOOK}
      - MESSAGE_TEMPLATE=ðŸŽ® {line}
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock:ro
    depends_on:
      - terraria
    restart: unless-stopped
